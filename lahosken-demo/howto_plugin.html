<!DOCTYPE html>
<html lang="en">

<!--
  Copyright 2014 Pants project contributors (see CONTRIBUTORS.md).
  Licensed under the Apache License, Version 2.0 (see LICENSE).
-->

<head>
  <meta charset="utf-8" />
  <title>Developing a Pants Plugin</title>
  <link rel="stylesheet" href="s.css">
  <script src="s.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="logo.ico">
</head>

<body>

<div id="navtoggler">
&#x25c4; <!-- triangle -->
</div>
<div class="mainflow">
<nav class="breadcrumbs">
<ul>
<li><a href="index.html">Welcome to the Pants build system.</a>
<li><a href="dev.html">Pants Developer Center</a>
<li><a href="howto_plugin.html">Developing a Pants Plugin</a>
</ul>
</nav>


<!-- main content start -->
<!-- generated by pants! -->
<style>
.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f0f0f0; }
.codehilite .c { color: #60a0b0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #808080 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0040D0 } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40a070 } /* Literal.Number */
.codehilite .s { color: #4070a0 } /* Literal.String */
.codehilite .na { color: #4070a0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60add5 } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287e } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #bb60d5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #40a070 } /* Literal.Number.Float */
.codehilite .mh { color: #40a070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40a070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40a070 } /* Literal.Number.Oct */
.codehilite .sb { color: #4070a0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070a0 } /* Literal.String.Char */
.codehilite .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070a0 } /* Literal.String.Double */
.codehilite .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070a0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #c65d09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070a0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #bb60d5 } /* Name.Variable.Class */
.codehilite .vg { color: #bb60d5 } /* Name.Variable.Global */
.codehilite .vi { color: #bb60d5 } /* Name.Variable.Instance */
.codehilite .il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h1 id="developing-a-pants-plugin">Developing a Pants Plugin</h1></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#developing-a-pants-plugin">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p><em>As of September 2014, this process is new and still evolving;</em> <em>expect
it to change somewhat.</em></p>
<p>This page documents how to develop a Pants plugin, a set of code that
defines new Pants functionality. If you
<a href="dev_tasks.html">develop a new task</a>
or target to add to Pants (or to
override an existing part of Pants), a plugin gives you a way to
register your code with Pants.</p>
<p>Much of Pants' own functionality is organized in plugins; see them in
<code>src/python/pants/backend/*</code>.</p>
<p>A plugin registers its functionality with Pants by defining some
functions in a <code>register.py</code> file in its top directory. For example,
Pants' <code>jvm</code> code registers in
<a href="https://github.com/pantsbuild/pants/blob/master/src/python/pants/backend/jvm/register.py">src/python/pants/backend/jvm/register.py</a>
Pants' backend-loader code assumes your plugin has a <code>register.py</code> file
there.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="simple-configuration">Simple Configuration</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#simple-configuration">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>If you want to extend Pants without adding any 3rd Party libraries that aren't already referenced by
Pants, you can use the following technique using sources stored directly
in your repo.  All you need to do is add the directory where your plugin sources are stored
to <code>PYTHONPATH</code> and put the package where the plugin is defined in <code>pants.ini</code>.</p>
<p>In the example below, the stock <code>maven_layout()</code> function will be extended by adding extra source
root definitions and library types.</p>
<ul>
<li>
<p>Define a home for your plugins. In this example we'll use a directory named 'plugins'</p>
</li>
<li>
<p>Create an empty  <code>plugins/ext_maven_layout/__init__.py</code> to define your python package.</p>
</li>
<li>
<p>Create a python module <code>plugins/ext_maven_layout/ext_maven_layout.py</code> that creates a new function
to enhance <code>maven_layout()</code>:</p>
<div class="codehilite"><pre><span class="c"># ext_maven_layout/ext_maven_layout.py</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">pants.backend.codegen.targets.java_wire_library</span> <span class="kn">import</span> <span class="n">JavaWireLibrary</span>
<span class="kn">from</span> <span class="nn">pants.backend.jvm.targets.jar_library</span> <span class="kn">import</span> <span class="n">JarLibrary</span>
<span class="kn">from</span> <span class="nn">pants.backend.maven_layout.maven_layout</span> <span class="kn">import</span> <span class="n">maven_layout</span>
<span class="kn">from</span> <span class="nn">pants.base.source_root</span> <span class="kn">import</span> <span class="n">SourceRoot</span>

<span class="k">def</span> <span class="nf">ext_maven_layout</span><span class="p">(</span><span class="n">parse_context</span><span class="p">,</span> <span class="n">basedir</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
 <span class="sd">"""Sets up typical maven project source roots for all built-in pants target types.</span>

<span class="sd"> See maven_layout() defined in the pants source code. Appends additional roots and targets</span>
<span class="sd"> to the stock version.</span>
<span class="sd"> """</span>
 <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">types</span><span class="p">):</span>
   <span class="n">SourceRoot</span><span class="o">.</span><span class="n">register_mutable</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parse_context</span><span class="o">.</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span> <span class="n">path</span><span class="p">),</span> <span class="o">*</span><span class="n">types</span><span class="p">)</span>

 <span class="c"># Use the stock maven_layout to get started</span>
 <span class="n">maven_layout</span><span class="p">(</span><span class="n">parse_context</span><span class="p">,</span> <span class="n">basedir</span><span class="o">=</span><span class="n">basedir</span><span class="p">)</span>

 <span class="c"># Add additional targets to existing source roots</span>
 <span class="n">root</span><span class="p">(</span><span class="s">'src/main/java'</span><span class="p">,</span> <span class="n">JarLibrary</span><span class="p">)</span>
 <span class="n">root</span><span class="p">(</span><span class="s">'src/test/java'</span><span class="p">,</span> <span class="n">JarLibrary</span><span class="p">)</span>

 <span class="c"># Add additional source roots</span>
 <span class="n">root</span><span class="p">(</span><span class="s">'src/main/wire_proto'</span><span class="p">,</span> <span class="n">JavaWireLibrary</span><span class="p">,</span> <span class="n">JarLibrary</span><span class="p">)</span>
 <span class="n">root</span><span class="p">(</span><span class="s">'src/test/wire_proto'</span><span class="p">,</span> <span class="n">JavaWireLibrary</span><span class="p">,</span> <span class="n">JarLibrary</span><span class="p">)</span>
</pre></div>
</li>
<li>
<p>Create <code>plugins/ext_maven_layout/register.py</code> to register the functions in your plugin.  When registering a
backend in pants.ini, register.py is used by the pants plugin api  to register new functions
exposed in build files, targets, tasks and goals:</p>
<div class="codehilite"><pre><span class="c"># plugins/ext_maven_layout/register.py</span>

<span class="kn">from</span> <span class="nn">pants.base.build_file_aliases</span> <span class="kn">import</span> <span class="n">BuildFileAliases</span>
<span class="kn">from</span> <span class="nn">ext_maven_layout.ext_maven_layout</span> <span class="kn">import</span> <span class="n">ext_maven_layout</span>

<span class="k">def</span> <span class="nf">build_file_aliases</span><span class="p">():</span>
 <span class="k">return</span> <span class="n">BuildFileAliases</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
   <span class="n">context_aware_object_factories</span><span class="o">=</span><span class="p">{</span>
    <span class="s">'ext_maven_layout'</span><span class="p">:</span> <span class="n">BuildFileAliases</span><span class="o">.</span><span class="n">curry_context</span><span class="p">(</span><span class="n">ext_maven_layout</span><span class="p">)</span>
   <span class="p">}</span>
 <span class="p">)</span>
</pre></div>
</li>
<li>
<p>Update your <code>pants</code> wrapper script to include the <code>plugins/</code> directory on <code>PYTHONPATH</code>:</p>
<div class="codehilite"><pre><span class="nv">PYTHONPATH</span><span class="o">=</span>plugins:<span class="k">${</span><span class="nv">PYTHONPATH</span><span class="k">}</span>
<span class="nb">export </span>PYTHONPATH
</pre></div>
</li>
<li>
<p>In <code>pants.ini</code>, add your new plugins directory to the list of backends to load when pants starts.
This instructs pants to look for a module named <code>ext_maven_layout.register</code> and invoke
it.</p>
<div class="codehilite"><pre><span class="p">[</span><span class="n">backends</span><span class="p">]</span>
<span class="n">packages</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">"ext_maven_layout"</span><span class="p">,</span>
  <span class="p">]</span>
</pre></div>
</li>
</ul>

<!-- main content end -->

<div class="generated">
Generated by <a href="http://pantsbuild.github.io/docs.html">publish_docs</a>
dist/markdown/html/src/python/pants/docs/howto_plugin.html 2014-12-18T14:46:53.455813
</div>

</div> <!-- end of mainflow -->

<nav class="bignav">
  <div class="bignav-logo">
    <a href="index.html">
      <img src="logo.ico" alt="[pantsbuild logo]">
    </a>
  </div>
  <form class="search" action="https://www.google.com/search">
  <input name="as_q" class="query">
  <input name="as_sitesearch" value="pantsbuild.github.io" type="hidden">
  <input value="Search" type=submit class="button">
  </form>

<div class="site-toc">
<ul>
<li class="toc-h1 ">
<a href="first_concepts.html">Pants Conceptual Overview</a>
</li>
<li class="toc-h1 ">
<a href="first_tutorial.html">First Tutorial</a>
</li>
<li class="toc-h1 ">
<a href="target_addresses.html">Target Addresses</a>
</li>
<li class="toc-h1 ">
<a href="JVMProjects.html">JVM Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="scala.html">Scala Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="from_maven.html">Pants for Maven Experts</a>
</li>
<li class="toc-h1 ">
<a href="python-readme.html">Python Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="pex_design.html">PEX Design</a>
</li>
<li class="toc-h2 ">
<a href="python_old.html">Using Pants for Python development, 2014 and Earlier</a>
</li>
<li class="toc-h1 ">
<a href="page.html">README Files and Markdown</a>
</li>
<li class="toc-h1 ">
<a href="build_files.html">BUILD files</a>
</li>
<li class="toc-h1 ">
<a href="invoking.html">Invoking Pants Build</a>
</li>
<li class="toc-h1 ">
<a href="tshoot.html">Troubleshooting</a>
</li>
<li class="toc-h1 ">
<a href="3rdparty.html">Third-Party Dependencies</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h1 ">
<a href="ThriftDeps.html">Using Pants with Thrift Dependencies</a>
</li>
<li class="toc-h1 ">
<a href="publish.html">Publishing Artifacts</a>
</li>
<li class="toc-h1 ">
<a href="with_emacs.html">Emacs With Pants</a>
</li>
<li class="toc-h1 ">
<a href="with_intellij.html">Using Pants with IntelliJ IDEA</a>
</li>
<li class="toc-h1 ">
<a href="install.html">Installing Pants</a>
</li>
<li class="toc-h1 ">
<a href="setup_repo.html">Set up Your Source Tree for Pants</a>
</li>
<li class="toc-h1 ">
<a href="build_dictionary.html">Pants BUILD Dictionary</a>
</li>
<li class="toc-h1 ">
<a href="goals_reference.html">Pants Goals Reference</a>
</li>
<li class="toc-h1 ">
<a href="dev.html">Pants Developer Center</a>
</li>
<li class="toc-h2 ">
<a href="howto_contribute.html">Pants Contributors Guide</a>
</li>
<li class="toc-h2 ">
<a href="howto_ask.html">How To Ask</a>
</li>
<li class="toc-h2 ">
<a href="howto_develop.html">Pants Developers Guide</a>
</li>
<li class="toc-h2 ">
<a href="dev_tasks.html">Task Developer's Guide</a>
</li>
<li class="toc-h3 ">
<a href="dev_tasks_publish_extras.html">Develop a Task to Publish &quot;Extra&quot; Artifacts</a>
</li>
<li class="toc-h2 toc-here">
Developing a Pants Plugin
</li>
<li class="toc-h2 ">
<a href="intellij.html">Pants Development with IntelliJ IDEA</a>
</li>
<li class="toc-h2 ">
<a href="internals.html">Pants Internals</a>
</li>
<li class="toc-h2 ">
<a href="release.html">Release Process</a>
</li>
<li class="toc-h2 ">
<a href="docs.html">About the documentation</a>
</li>
<li class="toc-h2 ">
<a href="credits.html">Credits</a>
</li>
</ul>
</div>
</nav>

<div class="ci-status">
<a href="https://travis-ci.org/pantsbuild/pants">
<img src="https://travis-ci.org/pantsbuild/pants.png?branch=master"
     alt="Are the tests passing?" title="Are the tests passing?"></a><br>
<a href="https://coveralls.io/r/pantsbuild/pants?branch=master">
<img src="https://coveralls.io/repos/pantsbuild/pants/badge.png?branch=master"
     alt="Test Coverage Status" title="Test Coverage Status"></a>
</div>

</body>
</html>

