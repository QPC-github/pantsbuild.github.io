<!DOCTYPE html>
<html lang="en">

<!--
  Copyright 2014 Pants project contributors (see CONTRIBUTORS.md).
  Licensed under the Apache License, Version 2.0 (see LICENSE).
-->

<head>
  <meta charset="utf-8"/>
  <title>Developing a Pants Plugin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="pants-logo.ico">
  <!-- In case this is a "test publish", tell search engines where real version lives: -->
  <link rel="canonical" href="https://pantsbuild.github.io/howto_plugin.html">

  <link rel="stylesheet" href="bootstrap-custom.min.css">
  <link rel="stylesheet" href="bootstrap-custom-theme.min.css">
  <link rel="stylesheet" href="docsite.css">
</head>

<body>

<div class="header">
  <nav class="navbar navbar-default navbar-static-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand navbar-brand-img" href="index.html">
          <img src="pants-logo.ico" alt="[pantsbuild logo]">
        </a>
        <a class="navbar-brand" href="index.html">
          Pants
        </a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/">Docs</a></li>
          <li><a href="community.html">Community</a></li>
          <li><a href="https://www.github.com/pantsbuild/pants">GitHub</a></li>
          <li>
            <form class="navbar-form navbar-left search" role="search" action="https://www.google.com/search">
              <div class="form-group">
                <input type="text" name="as_q" class="form-control query" placeholder="Search">
                <input name="as_sitesearch" value="pantsbuild.github.io" type="hidden">
              </div>
            </form>
          </li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>
</div>

<div class="page">

  <div class="container-fluid">
    <div class="row">

      <div class="col-md-1">
      </div>

      <div class="col-md-2">
        <div class="site-toc">
          <ul>
                <li class="toc-h1 toc-heading">
                  Getting Started
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="install.html">Installing Pants</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="setup_repo.html">Setting Up Pants</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="first_tutorial.html">Tutorial</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Pants Basics
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="why_use_pants.html">Why Use Pants?</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="first_concepts.html">Pants Concepts</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="build_files.html">BUILD files</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="target_addresses.html">Target Addresses</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="3rdparty.html">Third-Party Dependencies</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="options.html">Pants Options</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="invoking.html">Invoking Pants</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="reporting_server.html">Reporting Server</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="ide_support.html">IDE Support</a>
                </li>
                <li class="toc-h1 toc-heading">
                  JVM
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="jvm_projects.html">JVM Projects with Pants</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="scala.html">Scala Support</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="publish.html">Publishing Artifacts</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="from_maven.html">Pants for Maven Experts</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Python
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="python_readme.html">Python Projects with Pants</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="3rdparty_py.html">Python 3rdparty Pattern</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Codegen
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="thrift_deps.html">Thrift</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Docgen
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="page.html">Markdown</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Getting Help
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="tshoot.html">Troubleshooting</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="community.html">Community</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Reference
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="build_dictionary.html">Pants BUILD Dictionary</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="options_reference.html">Pants Reference</a>
                </li>
                <li class="toc-h1 toc-heading">
                  Developer
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="dev.html">Pants Developer Center</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="changelog.html">Release History</a>
                </li>
                <li class="toc-h1 toc-link ">
                  <a href="export.html">Export Format</a>
                </li>
          </ul>
        </div> <!-- site-toc -->
      </div>

      <div class="col-md-8">
        <div class="content">

          <div class="mainflow">
              <nav class="pagetoc">
                <ul>
                    <li class="toc-h1"><a href="#simple-configuration">Simple Configuration</a></li>
                    <li class="toc-h1"><a href="#examples-from-twittercommons">Examples from twitter/commons</a></li>
                </ul>
              </nav>

            <!-- main content start -->
            <!-- generated by pants! -->
<style>
.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f0f0f0; }
.codehilite .c { color: #60a0b0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #808080 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0040D0 } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40a070 } /* Literal.Number */
.codehilite .s { color: #4070a0 } /* Literal.String */
.codehilite .na { color: #4070a0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60add5 } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287e } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #bb60d5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #40a070 } /* Literal.Number.Float */
.codehilite .mh { color: #40a070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40a070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40a070 } /* Literal.Number.Oct */
.codehilite .sb { color: #4070a0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070a0 } /* Literal.String.Char */
.codehilite .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070a0 } /* Literal.String.Double */
.codehilite .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070a0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #c65d09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070a0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #bb60d5 } /* Name.Variable.Class */
.codehilite .vg { color: #bb60d5 } /* Name.Variable.Global */
.codehilite .vi { color: #bb60d5 } /* Name.Variable.Instance */
.codehilite .il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>
<h1 id="developing-a-pants-plugin">Developing a Pants Plugin</h1>
<p><em>As of September 2014, this process is new and still evolving;</em> <em>expect
it to change somewhat.</em></p>
<p>This page documents how to develop a Pants plugin, a set of code that
defines new Pants functionality. If you
<a href="dev_tasks.html">develop a new task</a>
or target to add to Pants (or to
override an existing part of Pants), a plugin gives you a way to
register your code with Pants.</p>
<p>Much of Pants' own functionality is organized in plugins; see them in
<a href="https://github.com/pantsbuild/pants/tree/master/src/python/pants/backend"><code>src/python/pants/backend/*</code></a>.</p>
<p>A plugin registers its functionality with Pants by defining some
functions in a <code>register.py</code> file in its top directory. For example,
Pants' <code>jvm</code> code registers in
<a href="https://github.com/pantsbuild/pants/blob/master/src/python/pants/backend/jvm/register.py">src/python/pants/backend/jvm/register.py</a>
Pants' backend-loader code assumes your plugin has a <code>register.py</code> file
there.</p>
<h2 id="simple-configuration">Simple Configuration</h2>
<p>If you want to extend Pants without adding any 3rd Party libraries that aren't already referenced by
Pants, you can use the following technique using sources stored directly
in your repo.  All you need to do is add the directory where your plugin sources are stored
to <code>PYTHONPATH</code> and put the package where the plugin is defined in <code>pants.ini</code>.</p>
<p>In the example below, the stock <code>JvmBinary</code> target will subclassed so that a custom task (not shown)
can consume it specifically but disregard regular <code>JvmBinary</code> instances (using <code>isinstance()</code>).</p>
<ul>
<li>
<p>Define a home for your plugins. In this example we'll use a directory named 'plugins'</p>
</li>
<li>
<p>Create an empty  <code>plugins/hadoop_binary/target/__init__.py</code> to define your python package.
  Also create empty <code>__init__.py</code> files in each directory up to but not including the root
  directory of your python package layout.</p>
</li>
<li>
<p>Create a python module <code>plugins/hadoop_binary/target/hadoop_binary.py</code>:</p>
<div class="codehilite"><pre><span class="c"># plugins/target/hadoop_binary.py</span>
<span class="kn">from</span> <span class="nn">pants.backend.jvm.targets.jvm_binary</span> <span class="kn">import</span> <span class="n">JvmBinary</span>

<span class="k">class</span> <span class="nc">HadoopBinary</span><span class="p">(</span><span class="n">JvmBinary</span><span class="p">):</span>
  <span class="k">pass</span>
</pre></div>
</li>
<li>
<p>Create <code>plugins/hadoop_binary/register.py</code> to register the functions in your plugin.  When registering a
backend in pants.ini, register.py is used by the pants plugin api to register new functions
exposed in build files, targets, tasks and goals:</p>
<div class="codehilite"><pre><span class="c"># plugins/hadoop_binary/register.py</span>

<span class="kn">from</span> <span class="nn">pants.build_graph.build_file_aliases</span> <span class="kn">import</span> <span class="n">BuildFileAliases</span>
<span class="kn">from</span> <span class="nn">hadoop_binary.target</span> <span class="kn">import</span> <span class="n">HadoopBinary</span>

<span class="k">def</span> <span class="nf">build_file_aliases</span><span class="p">():</span>
  <span class="k">return</span> <span class="n">BuildFileAliases</span><span class="p">(</span>
    <span class="n">targets</span><span class="o">=</span><span class="p">{</span>
      <span class="s">'hadoop_binary'</span><span class="p">:</span> <span class="n">HadoopBinary</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">)</span>
</pre></div>
</li>
<li>
<p>Update your <code>pants</code> wrapper script to include the <code>plugins/</code> directory on <code>PYTHONPATH</code>:</p>
<div class="codehilite"><pre><span class="nv">PYTHONPATH</span><span class="o">=</span>plugins:<span class="k">${</span><span class="nv">PYTHONPATH</span><span class="k">}</span>
<span class="nb">export </span>PYTHONPATH
</pre></div>
</li>
<li>
<p>In <code>pants.ini</code>, add your new plugins directory to the list of backends to load when pants starts.
This instructs pants to look for a module named <code>hadoop_binary.register</code> and invoke
it.</p>
<div class="codehilite"><pre><span class="p">[</span><span class="n">GLOBAL</span><span class="p">]</span>
<span class="n">backend_packages</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">"hadoop_binary"</span><span class="p">,</span>
  <span class="p">]</span>
</pre></div>
</li>
</ul>
<h2 id="examples-from-twittercommons">Examples from <code>twitter/commons</code></h2>
<p>For an example of a code repo with plugins to add features to Pants when building in that repo,
take a look at <a href="https://github.com/twitter/commons"><code>twitter/commons</code></a>, especially its
<a href="https://github.com/twitter/commons"><code>pants-plugin</code> directory</a>.</p>
<p>This repo has a <a href="https://github.com/twitter/commons/blob/master/pants"><code>pants</code> wrapper script</a>
that script adds <code>pants-plugins/src/python</code> to <code>PYTHONPATH</code>.</p>
<p>The repo's <a href="https://github.com/twitter/commons/blob/master/pants"><code>pants.ini</code> file</a> has a
<code>backend_packages</code> entry listing the plugin packages (packages with <code>register.py</code> files):</p>
<div class="codehilite"><pre><span class="p">[</span><span class="n">GLOBAL</span><span class="p">]</span>
<span class="n">backend_packages</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">'twitter.common.pants.jvm.args'</span><span class="p">,</span>
    <span class="s">'twitter.common.pants.jvm.extras'</span><span class="p">,</span>
    <span class="s">'twitter.common.pants.python.commons'</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
<p>The <a href="https://github.com/twitter/commons/blob/master/pants-plugins/src/python/twitter/common/pants/jvm/extras/register.py"><code>...jvm/extras/register.py</code></a>
file registers a <code>checkstyle</code> goal. To find the code for this task, come back to the
<code>pantsbuild/pants</code> repo: Pants defines the
<a href="https://github.com/pantsbuild/pants/blob/master/src/python/pants/backend/jvm/tasks/checkstyle.py"><code>Checkstyle</code> task class</a> but doesn't register it. But other Pants workspaces can register it, as
<code>twitter/commons</code> illustrates.</p>
<p>The <a href="https://github.com/twitter/commons/blob/master/pants-plugins/src/python/twitter/common/pants/jvm/args/register.py"><code>...jvm/args/register.py</code></a>
registers a goal, <code>args-apt</code>. This plugin also defines the
<a href="https://github.com/twitter/commons/blob/master/pants-plugins/src/python/twitter/common/pants/jvm/args/tasks/resource_mapper.py"><code>Task</code> class for this goal</a>.</p>
<p>(Somewhat confusingly, <code>twitter/commons</code>' has a <code>BUILD</code> file so it can publish its plugins as a
<code>setup_py</code> artifact. If you only use your plugin to build code in the <em>same</em> workspace,
your plugin directory tree does <em>not</em> need any <code>BUILD</code> files. By publishing this plugin, Twitter can
use its code in other workspaces, e.g., Twitter's internal codebase. Other folks can use it too:
introduce a dependency on <code>twitter.common.pants</code> and add entries to their <code>pants.ini backend_packages</code>
section.)</p>

            <!-- main content end -->

            <div class="generated">
              Generated by <a href="http://pantsbuild.github.io/docs.html">publish_docs</a>
              from dist/markdown/html/src/docs/howto_plugin.html 2016-04-30T13:01:56.275148
            </div>

          </div> <!-- mainflow -->

        </div> <!-- content -->

      </div>

      <div class="col-md-1">
      </div>

    </div> <!-- row -->
  </div> <!-- container-fluid -->

</div> <!-- page -->

<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha384-I6F5OKECLVtK/BL+8iSLDEHowSAfUo76ZL9+kGAgTRdiByINKJaqTPH/QVNS1VDb" crossorigin="anonymous"></script>
<script src="bootstrap-custom.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39101739-2', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
