<!DOCTYPE html>
<html lang="en">

<!--
  Copyright 2014 Pants project contributors (see CONTRIBUTORS.md).
  Licensed under the Apache License, Version 2.0 (see LICENSE).
-->

<head>
  <meta charset="utf-8" />
  <title>Pants Internals</title>
  <link rel="stylesheet" href="s.css">
  <script src="s.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="logo.ico">
  <!-- In case this is a "test publish", tell search engines where real version lives: -->
  <link rel="canonical" href="https://pantsbuild.github.io/internals.html">
</head>

<body>

<div id="navtoggler">
&#x25c4; <!-- triangle -->
</div>
<div class="mainflow">
<nav class="breadcrumbs">
<ul>
<li><a href="index.html">Pants Build</a>
<li><a href="dev.html">Pants Developer Center</a>
<li><a href="internals.html">Pants Internals</a>
</ul>
</nav>

<nav class="pagetoc">
<ul>
<li class="toc-h1"><a href="#how-some-base-classes-interrelate">How Some Base Classes Interrelate</a></li>
<li class="toc-h1"><a href="#examining-a-goal-task-chain">Examining a Goal-Task Chain</a></li>
<li class="toc-h1"><a href="#defining-a-task">Defining a Task</a></li>
</ul>
</nav>

<!-- main content start -->
<!-- generated by pants! -->
<style>
.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f0f0f0; }
.codehilite .c { color: #60a0b0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #808080 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0040D0 } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40a070 } /* Literal.Number */
.codehilite .s { color: #4070a0 } /* Literal.String */
.codehilite .na { color: #4070a0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60add5 } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287e } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #bb60d5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #40a070 } /* Literal.Number.Float */
.codehilite .mh { color: #40a070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40a070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40a070 } /* Literal.Number.Oct */
.codehilite .sb { color: #4070a0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070a0 } /* Literal.String.Char */
.codehilite .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070a0 } /* Literal.String.Double */
.codehilite .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070a0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #c65d09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070a0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #bb60d5 } /* Name.Variable.Class */
.codehilite .vg { color: #bb60d5 } /* Name.Variable.Global */
.codehilite .vi { color: #bb60d5 } /* Name.Variable.Instance */
.codehilite .il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h1 id="pants-internals">Pants Internals</h1></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#pants-internals">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Pants is a build tool. This document describes some of its internals,
concentrating on how to tailor Pants to your needs, such as integrating
it with other tools.</p>
<p>If you want to run Pants or to write BUILD files, you probably want the
<a href="first_concepts.html">Pants Conceptual Overview</a> instead.
But if you want to support a new tool or a new language, read on.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="how-some-base-classes-interrelate">How Some Base Classes Interrelate</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#how-some-base-classes-interrelate">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p><strong>Target</strong><br>
An addressable thing, such as a <code>python_binary</code> or <code>junit_tests</code>. To add
support for a new language, you probably want to add new target types to
represent things you can build with that language. Most Target instances
can depend on other Target instances. As a rule of thumb, if code in
Target _A_ imports code in Target <em>B</em>, then <em>A</em> depends on <em>B</em>. If <em>A</em>
depends on <em>B</em>, then when carrying out some goal on <em>A</em>, you can be sure
that goal has been carried out on <em>B</em>.
<!-- TODO: if there are one or more exemplary Target classes, link to them. --></br></p>
<p><strong>Goal</strong><br>
A build verb, such as compile or test. Internally, a goal is implemented
as a set of Tasks.</br></p>
<p><strong>Task</strong><br>
A Goal has one or more Tasks, which do the actual work of invoking
tools. A compile Goal, for example, could contain a Task for Java
compilation, a Task for Scala compilation, etc. If you want an existing
Goal to do something new (e.g., compile FooLang), instead of cramming
your code into an existing Task, you probably want to define a new Task
and install it in the existing Goal. A Task looks at the environment and
Targets, invokes some tool, generates things, and reports
success/failure. If you're giving Pants the ability to do something new,
you're probably adding a Task. See
<a href="dev_tasks.html">Developing a Pants Task</a>.</br></p>
<p><strong>Plugin (or "Backend")</strong><br>
Collection of Targets, Goals, Tasks, Commands to do something useful. At
Pants' core are the abstractions Target, and Task. These abstractions
don't do anything in particular. To build real code, you need to define
and register some more specific classes. For example, to build Java
code, you want the <code>JavaLibrary</code> Target, <code>ZincCompile</code> task (registered
in the <code>compile</code> goal), and many more. We organize this "real" code into
"plugins". A typical plugin defines several classes and registers them
with the Pants core. For a design discussion on registering plugins, see
the <a href="https://groups.google.com/forum/#!topic/pants-devel/uHGpR2K6FBI">Plugin
Engine</a>
<code>pants-devel</code> thread.</br></p>
<p><strong>Context</strong><br>
An API to the state of the world. A Task uses this to find out things
like the flags the user set on the command line, pants.ini config, and
the state of the build cache. The task uses context.products to
communicate results and requests for build results.</br></p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="examining-a-goal-task-chain">Examining a Goal-Task Chain</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#examining-a-goal-task-chain">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>It's not so easy to figure out in your head which Goals+Tasks are invoked for some command line.
The dependency relationships between Goals and Tasks gets complex. The <code>--explain</code> global flag
helps here. Instead of building something, it echoes a summary of the goals and tasks it
<em>would</em> use to build something. For example, you can find out what happens on a <code>compile</code>:</p>
<div class="codehilite"><pre><span class="nv">$.</span>/pants --explain compile
Goal Execution Order:

bootstrap -&gt; imports -&gt; gen -&gt; resolve -&gt; compile

Goal <span class="o">[</span>TaskRegistrar-&gt;Task<span class="o">]</span> Order:

bootstrap <span class="o">[</span>bootstrap-jvm-tools-&gt;BootstrapJvmTools<span class="o">]</span>
imports <span class="o">[</span>ivy-imports-&gt;IvyImports<span class="o">]</span>
gen <span class="o">[</span>thrift-&gt;ApacheThriftGen, scrooge-&gt;ScroogeGen, protoc-&gt;ProtobufGen, antlr-&gt;AntlrGen, ragel-&gt;RagelGen, jaxb-&gt;JaxbGen, aapt-&gt;AaptGen<span class="o">]</span>
resolve <span class="o">[</span>ivy-&gt;IvyResolve<span class="o">]</span>
compile <span class="o">[</span>jvm-&gt;SingletonGroupTask<span class="o">]</span>
<span class="err">$</span>
</pre></div>
<p>This tells you that the resolve goal comes before the compile goal, the
gen goal comes before that, etc. There is more than one Task registered
for the gen goal. In the gen [thrift-&gt;ApacheThriftGen,... text, thrift
is the name of a task and ApacheThriftGen is the name of the class that
implements it.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="defining-a-task">Defining a Task</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#defining-a-task">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Defining a new Task tells Pants of some new action it can take. This
might be a new goal or adding new functionality in an existing goal
(e.g., telling the "gen" code-generation goal about some new way to
generate code). See <a href="dev_tasks.html">Developing a Pants Task</a>.</p>

<!-- main content end -->

<div class="generated">
Generated by <a href="http://pantsbuild.github.io/docs.html">publish_docs</a>
from dist/markdown/html/src/python/pants/docs/internals.html 2016-01-28T10:47:29.907192
</div>

</div> <!-- end of mainflow -->

<nav class="bignav">
  <div class="bignav-logo">
    <a href="index.html">
      <img src="logo.ico" alt="[pantsbuild logo]">
    </a>
  </div>
  <form class="search" action="https://www.google.com/search">
  <input name="as_q" class="query" placeholder="Search">
  <input name="as_sitesearch" value="pantsbuild.github.io" type="hidden">
  </form>

<div class="site-toc">
<ul>
<li class="toc-h1 ">
<a href="first_concepts.html">Pants Conceptual Overview</a>
</li>
<li class="toc-h1 ">
<a href="install.html">Installing Pants</a>
</li>
<li class="toc-h1 ">
<a href="first_tutorial.html">First Tutorial</a>
</li>
<li class="toc-h1 ">
<a href="target_addresses.html">Target Addresses</a>
</li>
<li class="toc-h1 ">
<a href="JVMProjects.html">JVM Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="scala.html">Scala Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="from_maven.html">Pants for Maven Experts</a>
</li>
<li class="toc-h1 ">
<a href="python-readme.html">Python Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="pex_design.html">PEX Design</a>
</li>
<li class="toc-h1 ">
<a href="page.html">README Files and Markdown</a>
</li>
<li class="toc-h1 ">
<a href="build_files.html">BUILD files</a>
</li>
<li class="toc-h1 ">
<a href="invoking.html">Invoking Pants Build</a>
</li>
<li class="toc-h1 ">
<a href="tshoot.html">Troubleshooting</a>
</li>
<li class="toc-h1 ">
<a href="3rdparty.html">Third-Party Dependencies</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h1 ">
<a href="ThriftDeps.html">Using Pants with Thrift Dependencies</a>
</li>
<li class="toc-h1 ">
<a href="publish.html">Publishing Artifacts</a>
</li>
<li class="toc-h1 ">
<a href="with_emacs.html">Emacs With Pants</a>
</li>
<li class="toc-h1 ">
<a href="with_intellij.html">Using Pants with IntelliJ IDEA</a>
</li>
<li class="toc-h1 ">
<a href="setup_repo.html">Set up Your Source Tree for Pants</a>
</li>
<li class="toc-h1 ">
<a href="build_dictionary.html">Pants BUILD Dictionary</a>
</li>
<li class="toc-h1 ">
<a href="options_reference.html">Pants Reference</a>
</li>
<li class="toc-h1 ">
<a href="changelog.html">RELEASE HISTORY</a>
</li>
<li class="toc-h1 ">
<a href="export.html">Export Format</a>
</li>
<li class="toc-h1 ">
<a href="dev.html">Pants Developer Center</a>
</li>
<li class="toc-h2 ">
<a href="howto_contribute.html">Pants Contributors Guide</a>
</li>
<li class="toc-h2 ">
<a href="howto_ask.html">How To Ask</a>
</li>
<li class="toc-h2 ">
<a href="howto_develop.html">Pants Developers Guide</a>
</li>
<li class="toc-h2 ">
<a href="dev_tasks.html">Task Developer's Guide</a>
</li>
<li class="toc-h3 ">
<a href="dev_tasks_publish_extras.html">Develop a Task to Publish &quot;Extra&quot; Artifacts</a>
</li>
<li class="toc-h2 ">
<a href="howto_plugin.html">Developing a Pants Plugin</a>
</li>
<li class="toc-h2 ">
<a href="intellij.html">Pants Development with IntelliJ IDEA</a>
</li>
<li class="toc-h2 toc-here">
Pants Internals
</li>
<li class="toc-h2 ">
<a href="release.html">Release Process</a>
</li>
<li class="toc-h3 ">
<a href="release_jvm.html">JVM Artifact Release Process</a>
</li>
<li class="toc-h2 ">
<a href="docs.html">About the documentation</a>
</li>
<li class="toc-h2 ">
<a href="credits.html">Credits</a>
</li>
</ul>
</div>
</nav>

<div class="ci-status">
<a href="https://travis-ci.org/pantsbuild/pants">
<img src="https://travis-ci.org/pantsbuild/pants.png?branch=master"
     alt="Are the tests passing?" title="Are the tests passing?"></a><br>
<a href="https://coveralls.io/r/pantsbuild/pants?branch=master">
<img src="https://coveralls.io/repos/pantsbuild/pants/badge.png?branch=master"
     alt="Test Coverage Status" title="Test Coverage Status"></a>
</div>

</body>
</html>
