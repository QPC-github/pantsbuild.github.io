<!DOCTYPE html>
<html lang="en">

<!--
  Copyright 2014 Pants project contributors (see CONTRIBUTORS.md).
  Licensed under the Apache License, Version 2.0 (see LICENSE).
-->

<head>
  <meta charset="utf-8" />
  <title>BUILD files</title>
  <link rel="stylesheet" href="s.css">
  <script src="s.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="logo.ico">
</head>

<body>

<div id="navtoggler">
&#x25c4; <!-- triangle -->
</div>
<div class="mainflow">
<nav class="breadcrumbs">
<ul>
<li><a href="index.html">Pants Build</a>
<li><a href="build_files.html">BUILD files</a>
</ul>
</nav>

<nav class="pagetoc">
<ul>
<li class="toc-h1"><a href="#debugging-a-build-file">Debugging a BUILD File</a></li>
<li class="toc-h1"><a href="#default-target">Default Target</a></li>
<li class="toc-h1"><a href="#the-111-rule">The 1:1:1 Rule</a></li>
<li class="toc-h1"><a href="#avoid-rglobs">Avoid rglobs</a></li>
<li class="toc-h1"><a href="#define-separate-targets-for-interface-and-implementation">Define Separate Targets for Interface and Implementation</a></li>
<li class="toc-h1"><a href="#depend-on-api-in-library-targets-implementation-in-binary-targets">Depend on API in Library Targets, Implementation in Binary Targets</a></li>
<li class="toc-h1"><a href="#which-build-files-are-executed-and-how">Which BUILD Files are &quot;Executed&quot;? (and how?)</a></li>
<li class="toc-h1"><a href="#build-files_1">BUILD.* files</a></li>
<li class="toc-h1"><a href="#what-happened-to-the-pants-wrapper-around-targets">What happened to the pants() wrapper around targets?</a></li>
<li class="toc-h1"><a href="#using-an-older-version-of-pants">Using an older version of Pants?</a></li>
</ul>
</nav>

<!-- main content start -->
<!-- generated by pants! -->
<style>
.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f0f0f0; }
.codehilite .c { color: #60a0b0; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #007020; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #007020 } /* Comment.Preproc */
.codehilite .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #808080 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0040D0 } /* Generic.Traceback */
.codehilite .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #007020 } /* Keyword.Pseudo */
.codehilite .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #902000 } /* Keyword.Type */
.codehilite .m { color: #40a070 } /* Literal.Number */
.codehilite .s { color: #4070a0 } /* Literal.String */
.codehilite .na { color: #4070a0 } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.codehilite .no { color: #60add5 } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #007020 } /* Name.Exception */
.codehilite .nf { color: #06287e } /* Name.Function */
.codehilite .nl { color: #002070; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #062873; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #bb60d5 } /* Name.Variable */
.codehilite .ow { color: #007020; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #40a070 } /* Literal.Number.Float */
.codehilite .mh { color: #40a070 } /* Literal.Number.Hex */
.codehilite .mi { color: #40a070 } /* Literal.Number.Integer */
.codehilite .mo { color: #40a070 } /* Literal.Number.Oct */
.codehilite .sb { color: #4070a0 } /* Literal.String.Backtick */
.codehilite .sc { color: #4070a0 } /* Literal.String.Char */
.codehilite .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4070a0 } /* Literal.String.Double */
.codehilite .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #4070a0 } /* Literal.String.Heredoc */
.codehilite .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.codehilite .sx { color: #c65d09 } /* Literal.String.Other */
.codehilite .sr { color: #235388 } /* Literal.String.Regex */
.codehilite .s1 { color: #4070a0 } /* Literal.String.Single */
.codehilite .ss { color: #517918 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #bb60d5 } /* Name.Variable.Class */
.codehilite .vg { color: #bb60d5 } /* Name.Variable.Global */
.codehilite .vi { color: #bb60d5 } /* Name.Variable.Instance */
.codehilite .il { color: #40a070 } /* Literal.Number.Integer.Long */
</style>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h1 id="build-files">BUILD files</h1></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#build-files">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>To tell Pants about your source code, you have files named <code>BUILD</code> in
directories of your source tree. These files define build-able targets
and specify source code layout. This page goes into some detail about
<code>BUILD</code> files. If you instead wanted API docs for things defined in
<code>BUILD</code> files (<code>java_library</code>, <code>python_binary</code>, etc.), please see the
<a href="build_dictionary.html">BUILD Dictionary</a>. If you want less detail-y
information about <code>BUILD</code> files,
<a href="first_tutorial.html">the Tutorial</a>
is a good place to start.</p>
<p><code>BUILD</code> files are little Python scripts with some
<a href="build_dictionary.html">useful functions</a> automatically imported. Thus,
function invocations look <code>like(this)</code>, lists look <code>[like, this]</code>, and
dictionaries (hashmaps) look <code>{"like": "this"}</code>; Python's syntax uses
<a href="http://en.wikipedia.org/wiki/Python_syntax_and_semantics#Indentation">indentation</a>
to indicate scope; if you copy-paste some <code>BUILD</code> code from one place to
another, you might need to adjust the indentation. You can <a href="http://docs.python.org/tutorial">learn more
about Python</a>, but you should be able
to "get along" in <code>BUILD</code> files if you know functions, lists,
dictionaries, and indentation.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="debugging-a-build-file">Debugging a BUILD File</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#debugging-a-build-file">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>If you're curious to know how Pants interprets your <code>BUILD</code> file, these
techniques can be especially helpful:</p>
<p><em>Did I define the targets I meant to?</em> Use <code>goal list</code>:</p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants goal list examples/src/java/com/pants/examples/hello/greet
examples/src/java/com/pants/examples/hello/greet:greet
</pre></div>
<p><em>Did a change in one <code>BUILD</code> file break others?</em>
List <strong>every</strong> target to find out:
Use the recursive wildcard: <code>goal list ::</code></p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants goal list ::
  ...lots of output...
  File <span class="s2">"pants/commands/command.py"</span>, line 79, in __init__
  File <span class="s2">"pants/commands/goal_runner.py"</span>, line 144, in setup_parser
  File <span class="s2">"pants/base/build_graph.py"</span>, line 351, in inject_address_closure
TransitiveLookupError: great was not found in BUILD file examples/src/java/com/pants/examples/h
ello/greet/BUILD. Perhaps you meant:
  :greet
  referenced from examples/src/scala/com/pants/example/hello/welcome:welcome
<span class="nv">$ </span><span class="c"># Instead of listing all targets, an error message. We found a problem</span>
</pre></div>
<p><em>Do I pull in the dependencies I expect?</em> Use <code>goal depmap</code> (JVM languages only):</p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants goal depmap examples/tests/java/com/pants/examples/hello/greet
internal-examples.tests.java.com.pants.examples.hello.greet.greet
  internal-3rdparty.junit
    internal-3rdparty.hamcrest-core
      org.hamcrest-hamcrest-core-1.3
    junit-junit-dep-4.11
  internal-examples.src.java.com.pants.examples.hello.greet.greet
  internal-examples.src.resources.com.pants.example.hello.hello
  junit-junit-dep-4.11
  org.hamcrest-hamcrest-core-1.3
</pre></div>
<p><em>What source files do I depend on?</em> Use <code>goal filedeps</code>:</p>
<div class="codehilite"><pre><span class="nv">$ </span>./pants goal filedeps examples/src/java/com/pants/examples/hello/main
~archie/workspace/pants/examples/src/resources/com/pants/example/hello/BUILD
~archie/workspace/pants/examples/src/java/com/pants/examples/hello/main/BUILD
~archie/workspace/pants/examples/src/java/com/pants/examples/hello/main/config/greetee.txt
~archie/workspace/pants/examples/src/java/com/pants/examples/hello/greet/Greeting.java
~archie/workspace/pants/examples/src/resources/com/pants/example/hello/world.txt
~archie/workspace/pants/examples/src/java/com/pants/examples/hello/main/HelloMain.java
~archie/workspace/pants/examples/src/java/com/pants/examples/hello/greet/BUILD
</pre></div>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="default-target">Default Target</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#default-target">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>A build target with the same name as the <code>BUILD</code> file's containing directory is the
<em>default target</em>. To signal "<em>this</em> is the main useful target here" and as a convenience to users,
have a default.</p>
<p>Consider these libraries that use <code>tugboat</code> functionality. You can see that this code depends on
just the default <code>tugboat</code> target, and thus uses just core functionality:</p>
<div class="codehilite"><pre><span class="c"># depends on plain ol' tugboat</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'theodore'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'src/java/com/twitter/tugboat'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>You can tell this code uses optional functionality because it depends on
a specific non-default target:</p>
<div class="codehilite"><pre><span class="c"># depends on optional tugboat functionality</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'hank'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'src/java/com/twitter/tugboat:hispeed'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>Default targets are more convenient to reference on the command line. There are a
<a href="target_addresses.html#addresses_synonyms" pantsref="addresses_synonyms">few ways to refer to a target</a> on the command line.
It's especially convenient to refer to a default target on the command line. Consider these two
ways to refer to the same target:</p>
<div class="codehilite"><pre>//src/java/com/pants/tugboat:tugboat  # absolute target name
src/java/com/pants/tugboat/           # convenient command-line-completion syntax
</pre></div>
<p>By providing a default-name target, you make it easier for people to refer to it on the command
line. This gives them a better experience. BUILD files dependencies can be less verbose,
improving readability.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="the-111-rule">The 1:1:1 Rule</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#the-111-rule">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Your code's organization, including <code>BUILD</code> target configuration, makes
building easier or harder. Some folks summarize clear and scalable code
layout choice with the <strong>1:1:1</strong> rule of thumb:</p>
<ul>
<li><strong>1 Folder</strong></li>
<li><strong>1 Package</strong></li>
<li><strong>1 BUILD Target</strong></li>
</ul>
<p>If there's a set of code that usually goes together, it makes sense for
it to be in one folder using one package namespace. The folder should
have a <code>BUILD</code> file with one target to build that set of code.</p>
<p>If there's a subset of code that <em>doesn't</em> usually go together with the
rest of the code in some directory/target, it makes sense to move that
code out into another folder and its own package namespace. The new
folder should have its own <code>BUILD</code> file containing a target to build
that code.</p>
<p>Code belongs at the "leaves" of your directory tree. E.g., if
<code>.../foo/Foo.java</code> exists, you don't want to create
<code>.../foo/bar/Bar.java</code> in a subdirectory. (Or if you do, then you want
to move the other foo code to <code>../foo/justfoonotbar/Foo.java</code> or
somesuch.) This keeps all the code for a package in 1 Folder, 1 BUILD
target.</p>
<p><strong>1:1:1</strong> is a "rule of thumb", not a law. If your code breaks this
rule, it will still build. <strong>1:1:1</strong> tends to make your code easier to
work with.</p>
<p>If you're new to Pants, you might feel overwhelmed by all these <code>BUILD</code>
files; you might think it's simpler to have fewer of them: maybe just
one <code>BUILD</code> file in the "top folder" for a project that builds code from
several directories. But this "target coarseness" can waste your time:
you have a huge target that depends on everything that your source
depends on. If you divide your code into smaller, coherent targets, each
of those targets has only a subset of those dependencies.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="avoid-rglobs">Avoid rglobs</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#avoid-rglobs">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Many pants targets have sources, a list of filenames owned by the
target. It's common pattern to specify source files with globs; it's a
common <em>anti-pattern</em>, especially in targets hastily converted from
Maven poms, to specify source files with rglobs, the recursive version
of globs.</p>
<p>While valid, rglobs increases the chances of multiple targets claiming
the same sources. Consider the following refactor adding a subpackage:</p>
<div class="codehilite"><pre><span class="c"># 'maint' subpackage has been added.</span>
<span class="c"># src/java/com/twitter/tugboat/BUILD</span>
<span class="c"># src/java/com/twitter/tugboat/Tugboat.java</span>
<span class="c"># src/java/com/twitter/tugboat/maint/BUILD</span>
<span class="c"># src/java/com/twitter/tugboat/maint/MaintenanceLog.java</span>

<span class="c"># target src/java/com/twitter/tugboat</span>
<span class="c"># Existing target now unintentionally claims the 'maint' package.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'tugboat'</span><span class="p">,</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">rglobs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>

<span class="c"># target src/java/com/twitter/tugboat/maint</span>
<span class="c"># Sources are claimed by multiple targets.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'maint'</span><span class="p">,</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>Existing tugboat users now depend on tugboat's maint package, even
though the dependency was never intended. <strong>Avoiding rglobs helps avoid
surprises.</strong></p>
<p>Using <code>rglobs</code> also makes it easy to fall into making circular
dependencies. You want to avoid circular dependencies. If you later want
to factor your big target into a few focused-purpose targets, you'll
have to untangle those circular dependencies.</p>
<p>When a target should claim files in subpackages, it's both easy and
recommended to explicitly list which subpackages should be claimed.</p>
<div class="codehilite"><pre><span class="c"># target src/java/com/twitter/tugboat</span>
<span class="c"># Intentionally claims the 'maint' package.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'tugboat'</span><span class="p">,</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span>
    <span class="s">'*.java'</span><span class="p">,</span>
    <span class="s">'maint/*.java'</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">)</span>
</pre></div>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="define-separate-targets-for-interface-and-implementation">Define Separate Targets for Interface and Implementation</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#define-separate-targets-for-interface-and-implementation">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>If your code defines an API to be used by other modules, define a target
that builds just that interface.</p>
<p>Many programs provide a plugin interface so users can provide their own
functionality. For example, a tool might define a <code>DataImporter</code> interface
and let users provide plugins for each data source.</p>
<p>The simple approach of providing a single BUILD target for both
interface and implementations has a significant drawback: anyone wishing
to implement the interface must also depend on all dependencies for all
implementations co-published with the interface. The classpath bloats.
The risk of dependency conflicts increases greatly. For example:</p>
<div class="codehilite"><pre><span class="c"># Less than ideal layout - interface and implementations together.</span>
<span class="c"># src/java/com/twitter/etl/from/BUILD</span>
<span class="c"># src/java/com/twitter/etl/from/DataImporter.java</span>
<span class="c"># src/java/com/twitter/etl/from/FileDataImporter.java</span>
<span class="c"># src/java/com/twitter/etl/from/HBaseDataImporter.java</span>

<span class="c"># DO NOT bundle interface and implementations - forces extra dependencies.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'from'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'3rdparty/jvm/org/apache/hbase'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>To avoid this bloat, define separate packages for code that introduces many extra dependencies.
For example, if <code>FileDataImporter.java</code> only uses standard library classes, it's appropriate to
package it with the interface. HBase, however, is quite large, has many transitive dependencies,
and is only required by jobs that actually read from HBase. Not <code>DataImporter</code> user wants to pull
down all those dependencies. Separate it out into its own target:</p>
<div class="codehilite"><pre><span class="c"># Ideal repo layout - hbase as a subpackage and separate target.</span>
<span class="c"># src/java/com/twitter/etl/from/BUILD</span>
<span class="c"># src/java/com/twitter/etl/from/DataImporter.java</span>
<span class="c"># src/java/com/twitter/etl/from/FileDataImporter.java</span>
<span class="c"># src/java/com/twitter/etl/from/hbase/BUILD</span>
<span class="c"># src/java/com/twitter/etl/from/hbase/HBaseDataImporter.java</span>

<span class="c"># pants target src/java/com/twitter/etl/from</span>
<span class="c"># Including FileDataImporter is appropriate because it has no additional dependencies.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'from'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[],</span> <span class="c"># no extra dependencies</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>

<span class="c"># pants target src/java/com/twitter/etl/from/hbase</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'hbase'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'3rdparty/jvm/org/apache/hbase'</span><span class="p">,</span>
    <span class="s">'src/java/com/twitter/etl/from'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="n">sources</span><span class="o">=</span><span class="n">globs</span><span class="p">(</span><span class="s">'*.java'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>Existing code using a package for both an interface and implementations
should still expose the interface separately.</p>
<div class="codehilite"><pre><span class="c"># Less than ideal layout - interface and implementations together.</span>
<span class="c"># src/java/com/twitter/etl/from/BUILD</span>
<span class="c"># src/java/com/twitter/etl/from/DataImporter.java</span>
<span class="c"># src/java/com/twitter/etl/from/FileDataImporter.java</span>
<span class="c"># src/java/com/twitter/etl/from/HBaseDataImporter.java</span>

<span class="c"># Default target contains interface and lightweight implementation.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'from'</span><span class="p">,</span>
  <span class="n">sources</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'DataImporter.java'</span><span class="p">,</span>
    <span class="s">'FileDataImporter.java'</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">)</span>

<span class="c"># Implementation with heavyweight dependencies exposed separately.</span>
<span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'hbase'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'3rdparty/jvm/org/apache/hbase'</span><span class="p">,</span>
    <span class="s">'src/java/com/twitter/etl/from'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s">'HBaseDataImporter.java'</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="depend-on-api-in-library-targets-implementation-in-binary-targets">Depend on API in Library Targets, Implementation in Binary Targets</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#depend-on-api-in-library-targets-implementation-in-binary-targets">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>Some projects helpfully publish their API separately from
implementation, especially if multiple implementations are available.
SLF4J is a widely-used example.</p>
<p>Consider the following library target that depends on both slf4j-api and
the specific implementation slf4j-jdk14.</p>
<div class="codehilite"><pre><span class="c"># Incorrect - forces a logging implementation on all library users.</span>
<span class="n">scala_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'mylib'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'3rdparty:slf4j-api'</span><span class="p">,</span>
    <span class="s">'3rdparty:slf4j-jdk14'</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">)</span>

<span class="n">jvm_binary</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'mybin'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="s">':mylib'</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
<p>Structure these dependencies to only depending on the API in library
code. Allow binary targets to specify the logging implementation of
their choosing.</p>
<div class="codehilite"><pre><span class="c"># Better approach - only depend on API in a library target.</span>
<span class="n">scala_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'mylib'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'3rdparty:slf4j-api'</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">)</span>

<span class="c"># Bring your own API implementation in the binary.</span>
<span class="n">jvm_binary</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'mybin'</span><span class="p">,</span>
  <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span>
    <span class="s">'3rdparty:slf4j-jdk14'</span><span class="p">,</span>
    <span class="s">':mylib'</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">)</span>
</pre></div>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="which-build-files-are-executed-and-how">Which <code>BUILD</code> Files are "Executed"? (and how?)</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#which-build-files-are-executed-and-how">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p><code>BUILD</code> files are little Python scripts. When you notice a target in one
<code>BUILD</code> file can depend on a target in another <code>BUILD</code> file, you might
think those little Python scripts are linked together into one big
Python program, but that's not exactly what's going on. If one <code>BUILD</code>
file has a Python variable <code>x = "Hello world"</code> and another <code>BUILD</code> file
says <code>print(x)</code>, you'll get an error: <code>x</code> is not defined.</p>
<p>Pants executes <code>BUILD</code> files separately. Commands in <code>BUILD</code> files
define targets and register those targets in a Pants data structure.</p>
<p>Though your repo might contain many <code>BUILD</code> files, Pants might not
execute all of them. If you invoke:</p>
<div class="codehilite"><pre>./pants goal <span class="nb">test </span>examples/tests/java/com/pants/examples/hello/greet:greet
</pre></div>
<p>Pants executes the source tree's top-level <code>BUILD</code> file (executed on
every Pants run) and
<code>examples/tests/java/com/pants/examples/hello/greet/BUILD</code>. The <code>greet</code>
target depends on targets from other <code>BUILD</code> files, so Pants executes
those <code>BUILD</code> files, too; it iterates over the dependency tree,
executing <code>BUILD</code> files as it goes. It does <em>not</em> execute <code>BUILD</code> files
that don't contain targets in that dependency tree.</p>
<p>If there's some <code>BUILD</code> code that should be executed on every run, put
it in the source tree's top-level <code>BUILD</code> file; that gets executed on
every Pants run.</p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="build-files_1"><code>BUILD.*</code> files</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#build-files_1">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>We call them "<code>BUILD</code> files" because they're usually named <code>BUILD</code>, but
they can also be named <code>BUILD.something</code>, where <em>something</em> is typically
a short nickname for an organization, e.g., <code>BUILD.twitter</code>. This can be
handy if your organization has some internal definitions that you need
to combine with code that you open-source, perhaps a <code>credentials</code>
definition that only makes sense behind your organization's firewall.</p>
<p>A build target defined in <code>BUILD.foo</code> can't have the same <code>name</code> as a
build target defined in the same directory's <code>BUILD</code> file; they share a
namespace.</p>
<p><a id="build_pants_wrapper_gone" pantsmark="build_pants_wrapper_gone"> </a></p>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="what-happened-to-the-pants-wrapper-around-targets">What happened to the <code>pants()</code> wrapper around targets?</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#what-happened-to-the-pants-wrapper-around-targets">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>If you have an existing project using Pants and have recently upgraded, you
may encounter this warning:</p>
<div class="codehilite"><pre>*** pants() wrapper is obsolete and will be removed in a future release.
</pre></div>
<p>or the BUILD may fail an error.</p>
<div class="codehilite"><pre>NameError: name 'pants' is not defined
</pre></div>
<p>In pre-release versions of Pants, targets declared in the <code>dependencies</code>
attribute had to be wrapped in a call to the <code>pants()</code> method.</p>
<div class="codehilite"><pre><span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'foo'</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">pants</span><span class="p">(</span><span class="s">'bar'</span><span class="p">)])</span>
</pre></div>
<p>The <code>pants()</code> method has since been replaced with a noop and as of Pants
0.0.24 is officially deprecated. The above snippet should be re-written
to use the target as a plain string.</p>
<div class="codehilite"><pre><span class="n">java_library</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'foo'</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="s">'bar'</span><span class="p">])</span>
</pre></div>
<p>You can use <code>sed</code> or a similar utility to quickly remove these
references from your BUILD files with a regular expression.</p>
<div class="codehilite"><pre><span class="c"># Run this command from the root of your repo.</span>
<span class="nv">$ </span>sed -i <span class="s2">""</span> -e <span class="s1">'s/pants(\([^)]*\))/\1/g'</span> <span class="sb">`</span>find . -name <span class="s2">"BUILD*"</span><span class="sb">`</span>
</pre></div>

<table class="h-plus-pilcrow">
<tbody>
<tr>
<td class="h-plus-pilcrow-holder"><h2 id="using-an-older-version-of-pants">Using an older version of Pants?</h2></td>
<td><div class="pilcrow-div">
<a class="pilcrow-link" href="#using-an-older-version-of-pants">¶</a>
</div></td>
</tr>
</tbody>
</table>

<p>If you are following along in these examples and are using a version of
pants prior to the 2014 open source release you might see one of the
following messages:</p>
<p>From a <code>python_*</code> target dependencies attribute:</p>
<div class="codehilite"><pre>AttributeError: 'str' object has no attribute 'resolve'
</pre></div>
<p>From a <code>java_library</code> dependencies attribute:</p>
<div class="codehilite"><pre>The following targets could not be loaded:
  src/java/com/twitter/foo/bar/baz =&gt;
    TargetDefinitionException: Error with src/java/com/foo/bar/baz/BUILD:baz:
       Expected elements of list to be (&lt;class 'twitter.pants.targets.external_dependency.ExternalDependency'&gt;, &lt;class 'twitter.pants.targets.anonymous.AnonymousDeps'&gt;,
         &lt;class 'twitter.pants.base.target.Target'&gt;), got value 3rdparty:guava of type &lt;type 'str'&gt;
</pre></div>
<p>From a <code>java_library</code> resources attribute:</p>
<div class="codehilite"><pre>IOError: [Errno 2] No such file or directory: '/Users/pantsaddict/workspace/src/resources/com/foo/bar'
</pre></div>
<p>From a <code>junit_tests</code> resources attribute:</p>
<div class="codehilite"><pre>ValueError: Expected elements of list to be &lt;class 'twitter.pants.base.target.Target'&gt;, got value tests/scala/foo/bar/baz/resources of type &lt;type 'str'&gt;
</pre></div>
<p>From a <code>provides</code> repo attribute:</p>
<div class="codehilite"><pre>ValueError: repo must be Repository or Pants but was foo/bar/baz:baz
</pre></div>
<p>All of these errors likely mean that you need to wrap the strings
mentioned in the error message with the <code>pants()</code> wrapper function in
your BUILD files. The open source Pants release deprecated the use of
this wrapper and thus examples in this documentation don't include it.
For more information, see the
<a href="build_files.html#build_pants_wrapper_gone" pantsref="build_pants_wrapper_gone"><code>pants</code> wrapper</a> notes above.</p>

<!-- main content end -->

<div class="generated">
Generated by <a href="http://pantsbuild.github.io/docs.html">publish_docs</a>
from dist/markdown/html/src/docs/build_files.html 2015-01-14T13:38:08.743426
</div>

</div> <!-- end of mainflow -->

<nav class="bignav">
  <div class="bignav-logo">
    <a href="index.html">
      <img src="logo.ico" alt="[pantsbuild logo]">
    </a>
  </div>
  <form class="search" action="https://www.google.com/search">
  <input name="as_q" class="query" placeholder="Search">
  <input name="as_sitesearch" value="pantsbuild.github.io" type="hidden">
  </form>

<div class="site-toc">
<ul>
<li class="toc-h1 ">
<a href="first_concepts.html">Pants Conceptual Overview</a>
</li>
<li class="toc-h1 ">
<a href="first_tutorial.html">First Tutorial</a>
</li>
<li class="toc-h1 ">
<a href="target_addresses.html">Target Addresses</a>
</li>
<li class="toc-h1 ">
<a href="JVMProjects.html">JVM Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="scala.html">Scala Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="from_maven.html">Pants for Maven Experts</a>
</li>
<li class="toc-h1 ">
<a href="python-readme.html">Python Projects with Pants</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="pex_design.html">PEX Design</a>
</li>
<li class="toc-h2 ">
<a href="python_old.html">Using Pants for Python development, 2014 and Earlier</a>
</li>
<li class="toc-h1 ">
<a href="page.html">README Files and Markdown</a>
</li>
<li class="toc-h1 toc-here">
BUILD files
</li>
<li class="toc-h1 ">
<a href="invoking.html">Invoking Pants Build</a>
</li>
<li class="toc-h1 ">
<a href="tshoot.html">Troubleshooting</a>
</li>
<li class="toc-h1 ">
<a href="3rdparty.html">Third-Party Dependencies</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_jvm.html">JVM 3rdparty Pattern</a>
</li>
<li class="toc-h2 ">
<a href="3rdparty_py.html">Python 3rdparty Pattern</a>
</li>
<li class="toc-h1 ">
<a href="ThriftDeps.html">Using Pants with Thrift Dependencies</a>
</li>
<li class="toc-h1 ">
<a href="publish.html">Publishing Artifacts</a>
</li>
<li class="toc-h1 ">
<a href="with_emacs.html">Emacs With Pants</a>
</li>
<li class="toc-h1 ">
<a href="with_intellij.html">Using Pants with IntelliJ IDEA</a>
</li>
<li class="toc-h1 ">
<a href="install.html">Installing Pants</a>
</li>
<li class="toc-h1 ">
<a href="setup_repo.html">Set up Your Source Tree for Pants</a>
</li>
<li class="toc-h1 ">
<a href="build_dictionary.html">Pants BUILD Dictionary</a>
</li>
<li class="toc-h1 ">
<a href="goals_reference.html">Pants Goals Reference</a>
</li>
<li class="toc-h1 ">
<a href="changelog.html">RELEASE HISTORY</a>
</li>
<li class="toc-h1 ">
<a href="dev.html">Pants Developer Center</a>
</li>
<li class="toc-h2 ">
<a href="howto_contribute.html">Pants Contributors Guide</a>
</li>
<li class="toc-h2 ">
<a href="howto_ask.html">How To Ask</a>
</li>
<li class="toc-h2 ">
<a href="howto_develop.html">Pants Developers Guide</a>
</li>
<li class="toc-h2 ">
<a href="dev_tasks.html">Task Developer's Guide</a>
</li>
<li class="toc-h3 ">
<a href="dev_tasks_publish_extras.html">Develop a Task to Publish &quot;Extra&quot; Artifacts</a>
</li>
<li class="toc-h2 ">
<a href="howto_plugin.html">Developing a Pants Plugin</a>
</li>
<li class="toc-h2 ">
<a href="intellij.html">Pants Development with IntelliJ IDEA</a>
</li>
<li class="toc-h2 ">
<a href="internals.html">Pants Internals</a>
</li>
<li class="toc-h2 ">
<a href="release.html">Release Process</a>
</li>
<li class="toc-h2 ">
<a href="docs.html">About the documentation</a>
</li>
<li class="toc-h2 ">
<a href="credits.html">Credits</a>
</li>
</ul>
</div>
</nav>

<div class="ci-status">
<a href="https://travis-ci.org/pantsbuild/pants">
<img src="https://travis-ci.org/pantsbuild/pants.png?branch=master"
     alt="Are the tests passing?" title="Are the tests passing?"></a><br>
<a href="https://coveralls.io/r/pantsbuild/pants?branch=master">
<img src="https://coveralls.io/repos/pantsbuild/pants/badge.png?branch=master"
     alt="Test Coverage Status" title="Test Coverage Status"></a>
</div>

</body>
</html>
